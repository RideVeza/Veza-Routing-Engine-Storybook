import{j as s}from"./factory-BYdAncit.js";import{r as d}from"./index-BP8_t0zE.js";import{d as B}from"./styled-components.browser.esm-BzjHiQVu.js";import{S as C,b as p}from"./jobs-CSoPBwjn.js";import{t as I}from"./theme-CBi4L4pb.js";import{C as k}from"./ContentHeader-CIXz8JLl.js";import{J as H}from"./JobFormBusinessRules-dCjHxaHI.js";import{J as R}from"./JobFormInformation-B3JXbV9J.js";import{J as P}from"./JobFormNavbar-CvHdOaj0.js";import{J as V}from"./JobFormSchools-Biz2-B3u.js";import{J as L}from"./JobFormStaffs-CqGY0jUo.js";import{J as M}from"./JobFormStudents-BHiZVefF.js";import{J as $}from"./JobFormSummary-BtMNOCjM.js";import{J as D}from"./JobFormVehicles-36P_lv_P.js";import{u as O}from"./use-form-B68HMyzB.js";import{n as G}from"./notifications.store-rT8tHzW-.js";const Y=B.div`
  .header-container {
    border-bottom: 0.5px solid ${l=>l.theme.colors.gray[2]};
  }

  .job-form-main-section {
    height: 82vh;
    display: flex;
    flex-direction: row;
    gap: 2px;
  }

  .form-content {
    width: 100%;
    height: 100%;
  }
`,q=({onClose:l,onSave:h})=>{const[c,S]=d.useState("Information"),[f,b]=d.useState([]),[y,g]=d.useState([]),[J,x]=d.useState([]),a=O({initialValues:{jobName:"",shortHandJobName:"",startDate:"",endDate:"",defaultBellTimeAndDay:{start_bell_time:"",end_bell_time:""},business_rule_params:{max_student_loaded_time:0,max_student_onboarding_time:0,student_staff_ratio:null,curbside_pickup_dropoff:!1,default_dwell_time:0,all_staffs_meet_at_yard:!1,num_routes:null,start_end_location:C.YARD,max_walking_distance:0,allow_mixed_schools:!1,mixed_pickup_dropoff:!1,max_staff_onboarding_time:0,staff_boarding:p.ALL_MEET_AT_STARTING_POINT},staff_types:[],students:[],staffs:{},stops:[],yards:[],schools:[],vehicles:[]},validate:{shortHandJobName:o=>o?null:"Job Name is required",jobName:o=>o?o.length>=2?null:"Short Hand must have at least 2 characters":null,startDate:o=>o?o.length>=2?null:"Short Hand must have at least 2 characters":null,endDate:o=>o?o.length>=2?null:"Short Hand must have at least 2 characters":null}}),v={Information:s.jsx(R,{form:a}),Students:s.jsx(M,{form:a,selectedStudents:f,setSelectedStudents:b}),Schools:s.jsx(V,{form:a,schools:a.values.schools??[],students:f}),Staff:s.jsx(L,{form:a,selectedStaffs:y,setSelectedStaffs:g}),Vehicles:s.jsx(D,{form:a,selectedVehicles:J,setSelectedVehicles:x}),"Business rules":s.jsx(H,{form:a}),Summary:s.jsx($,{form:a})},A=()=>{var _,u;const o=a.values,r=JSON.parse(JSON.stringify(o));let N=1;const i=new Map,j=e=>`${e.street}-${e.city}-${e.province}-${e.postal_code}`,m=e=>{const t=j(e);return i.has(t)||i.set(t,N++),i.get(t)};(_=r.students)!=null&&_.length||G.show({color:"red",title:"Error",message:"Students not defined."}),r.students=r.students.map(e=>(e.address.home_address=m(e.address.home_address),e.address.pick_up_stop=e.address.pick_up_stop.map(t=>{const n=t.stop;return t.stop=m(n),t}),e.address.drop_off_stop=e.address.drop_off_stop.map(t=>{const n=t.stop;return t.stop=m(n),t}),e)),r.stops=Array.from(i.entries()).map(([e,t])=>{const[n,E,F,w]=e.split("-");return{id:t,address:{street:n,city:E,province:F,postal_code:w}}}),r.students.forEach(e=>{e.dwell_time||(e.dwell_time=r.business_rule_params.default_dwell_time)}),r.yards=[{id:89,name:"4Seasons HQ",service_duration:10,address:{street:"85 Freeport Boulevard NE",city:"Calgary",province:"AB",postal_code:"T3J 4X8"}},{id:90,name:"Calgary yard",service_duration:10,address:{street:"1210 Russet Rd NE",city:"Calgary",province:"AB",postal_code:"T2G 1E8"}},{id:91,name:"Hamptons yard",service_duration:10,address:{street:"2502 6 St NE",city:"Calgary",province:"AB",postal_code:"T2E 3Z3"}}];const T=((u=r.business_rule_params)==null?void 0:u.staff_boarding)===p.ALL_MEET_AT_STARTING_POINT;return r.business_rule_params.all_staffs_meet_at_yard=T,r.defaultBellTimeAndDay.start_bell_time="09:30",r.defaultBellTimeAndDay.end_bell_time="14:00",r};return s.jsxs(Y,{theme:I,children:[s.jsx("div",{className:"header-container",children:s.jsx(k,{primaryTitle:"New Routing Job",headerAlign:"center",onSecondaryClick:l,onPrimaryClick:h,primaryButtonVariant:"light"})}),s.jsxs("div",{className:"job-form-main-section",children:[s.jsx(P,{activeStep:c,setActiveStep:S,onContinue:A}),s.jsx("div",{className:"form-content",children:v[c]})]})]})};q.__docgenInfo={description:"",methods:[],displayName:"JobForm"};export{q as J};
